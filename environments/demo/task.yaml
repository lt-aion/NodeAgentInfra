nameOverride: ""
fullnameOverride: "task-svc"

replicaCount: 1

serviceAccount:
  create: true

service:
  type: NodePort
  nodePort: 30002

containers:
  - name: main
    image:
      repository: 056562102950.dkr.ecr.ap-south-1.amazonaws.com/aion/nodeagent-task-svc
      pullPolicy: IfNotPresent
      tag: "latest"
    ports:
      http: 9002
    env:
      - name: ENV
        value: "development"
      - name: SERVER_PORT
        value: "9002"
      - name: DB_CONNECTION_URL
        value: "postgres://postgres:postgres@localhost:5432/nodeagent-task-svc?sslmode=disable"
      - name: AUTHN_SERVICE_URL
        value: "http://authn-svc:9001"
      - name: LOG_LEVEL
        value: "info"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
    livenessProbe:
      httpGet:
        path: /healthz/live
        port: main-http
    readinessProbe:
      httpGet:
        path: /healthz/ready
        port: main-http

  - name: postgres
    image:
      repository: postgres
      pullPolicy: IfNotPresent
      tag: "15-alpine"
    ports:
      additional:
        - name: pg
          containerPort: 5432
          protocol: TCP
    env:
      - name: POSTGRES_USER
        value: "postgres"
      - name: POSTGRES_PASSWORD
        value: "postgres"
      - name: POSTGRES_DB
        value: "nodeagent-task-svc"
      - name: POSTGRES_HOST_AUTH_METHOD
        value: "trust"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
    volumeMounts:
      - name: dshm
        mountPath: /dev/shm

volumes:
  - name: dshm
    emptyDir:
      medium: Memory

podDisruptionBudget:
  maxUnavailable: 1
